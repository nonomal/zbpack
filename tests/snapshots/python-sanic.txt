PlanType: docker

Meta:
  content: "ARG PYTHON_VERSION=3.8.5\nARG PYTHON_PACKAGE=sanic_template\nARG WORKDIR=/usr/src/app\n\nFROM python:${PYTHON_VERSION}\nARG PYTHON_PACKAGE\nARG WORKDIR\n\n# Meta information\nLABEL version=\"0.0.1\"\nLABEL description=\"Container with Sanic Template API service\"\n\n# Internal params\nENV PYTHONDONTWRITEBYTECODE 1\nENV PYTHONUNBUFFERED 1\nENV PYTHON_PACKAGE ${PYTHON_PACKAGE}\n\n# Adding sanic user and group\nRUN set -o errexit -o nounset \\\n    && echo \"Adding sanic user and group\" \\\n    && groupadd --system --gid 1000 sanic \\\n    && useradd --system --gid sanic --uid 1000 --shell /bin/bash --no-create-home sanic \\\n    && mkdir --parents ${WORKDIR} && chown -R sanic:sanic ${WORKDIR}\n\nUSER sanic\n\n# Preparing of environment\nWORKDIR ${WORKDIR}\n\n# Add a launcher\nCOPY --chown=sanic:sanic ./entrypoint.sh ./\nRUN chmod +x ./entrypoint.sh\n\n# Installation of dependencies\nCOPY --chown=sanic:sanic ./requirements/development.txt ./requirements.txt\n\n# Use root privilegies to install packages\nUSER root\nRUN pip install --no-cache-dir -r ./requirements.txt\nUSER sanic\n\n# Add a source code\nCOPY --chown=sanic:sanic ./migrations ./migrations\nCOPY --chown=sanic:sanic ./alembic.ini ./alembic.ini\nCOPY --chown=sanic:sanic ./manage.py ./manage.py\nCOPY --chown=sanic:sanic ./${PYTHON_PACKAGE} ./${PYTHON_PACKAGE}\n\n# Removing of unused parts (use root privilegies)\nUSER root\nRUN rm -rf ./requirements.txt\nUSER sanic\n\n# Launcher\nENTRYPOINT [\"./entrypoint.sh\"]\n\nEXPOSE 8000\n"
  expose: "8000"
